/*
 * jQuery addDot Plugin v1.0
 * 
 * Copyright 2012, DotDesign
 * Author: Nishant Joshi
 * Website: www.dotdesign.in
 * Email: info@dotdesign.in, dotdesign.in@gmail.com
 * 
 * Concept development started in January 2012
 *
 * v1.0.0 - 28th March 2012
 * First release
 *
 * v1.0.1 - 28th March 2012
 * Added feature to add button label instead of button icon. So user can add 
 * ("1, 2, 3...", "a, b, c...", "A, B, C...", "I, II, III...") instead of open hot spot icon.
 *
 * v1.0.2 - 5th April 2012
 * Functionality added to maintain z-index to avoid overlapping of hot spot labels.
 *
 * v1.0.3 - 12th April 2012
 * Added feature for open hot spot label direction. User can specify hot spot label open direction as either 
 * "Left to Right" or "Right to Left" horizontally 
 * and "Up" or "Down" vertically.
 *
 * v1.0.4 - 18th April 2012
 * Added feature for opening only one hot spot label at a time, previously opened hot spot will be hide.
 *
 * v1.0.5 - 2nd June 2012
 * Change HTML tag of Label Text from <p> to <div> so that user can add <hx>, <xl> etc tags in label.
 *
 * v1.0.6 - 6th June 2012
 * Fix the bug when user has specified width & height both. It was coming out of max allowed height.
 * Also hot spot box width is now calculated based on image width/height rather than container width/height. If user
 * wants it to set contaienr width/height as max allowed width/height just write...
 *
 * this.dotBoxWidth = this.$dotBox.outerWidth(true);
 * this.dotBoxHeight = this.$dotBox.outerHeight(true);
 */

(function(b){var a=function(d,c){this.$dotBox=b(d);this.$dotBox.css("position","relative");this.$dotBox.attr("style","position:relative");this.dotBoxWidth=b("img",this.$dotBox).outerWidth(true);this.dotBoxHeight=b("img",this.$dotBox).outerHeight(true);this.dotLen=this.$dotBox.children().length-1;this.dotLen++;this.dotObjId=this.$dotBox.attr("id")+"_"+this.dotLen;this.$dotObj;this.$labelTxtObj;this.$showHideBtnObj;return this};a.prototype={buildHotSpot:function(d){this.settings=b.extend({},b.fn.addDot.defaults,d);var c;var e=this.$dotBox;this.settings=b.extend({},b.fn.addDot.defaults,d);if(this.settings.withinBoundary==true&&this.settings.leftPos>=this.dotBoxWidth){this.settings.leftPos=this.dotBoxWidth-150}if(this.settings.withinBoundary==true&&this.settings.topPos>=this.dotBoxHeight){this.settings.topPos=this.dotBoxHeight-150}if(this.settings.btnLabel!=undefined){c=this.settings.btnLabel}else{c=""}e.append(b("<div class=defaultDot></div>").attr("id",this.dotObjId).css({left:this.settings.leftPos,top:this.settings.topPos}).html("<div class=labelTxt>"+this.settings.label+"</div><p class=showHideBtn>"+c+"</p><p style='clear:both'></p>"));this.$dotObj=b("#"+this.dotObjId);this.$labelTxtObj=b(".labelTxt",this.$dotObj);this.$showHideBtnObj=b(".showHideBtn",this.$dotObj);this.btnHeight=this.$showHideBtnObj.outerHeight(true);this.maxAllowedWidth=this.dotBoxWidth-this.settings.leftPos-parseInt(this.$dotObj.css("margin-left"),10)-parseInt(this.$dotObj.css("margin-right"),10)-parseInt(this.$dotObj.css("padding-left"),10)-parseInt(this.$dotObj.css("padding-right"),10)-parseInt(this.$dotObj.css("borderLeftWidth"),10)-parseInt(this.$dotObj.css("borderRightWidth"),10);this.maxAllowedHeight=this.dotBoxHeight-this.settings.topPos-parseInt(this.$dotObj.css("margin-top"),10)-parseInt(this.$dotObj.css("margin-bottom"),10)-parseInt(this.$dotObj.css("padding-top"),10)-parseInt(this.$dotObj.css("padding-bottom"),10)-parseInt(this.$dotObj.css("borderTopWidth"),10)-parseInt(this.$dotObj.css("borderBottomWidth"),10);if(this.settings.boundaryPadding){this.maxAllowedWidth-=this.settings.boundaryPadding;this.maxAllowedHeight-=this.settings.boundaryPadding}if(this.settings.width){this.$labelTxtObj.css("white-space","normal")}if(this.settings.height){this.$labelTxtObj.css("white-space","normal")}if(this.settings.thumbImg!=undefined){this.$labelTxtObj.prepend('<img src="'+this.settings.thumbImg+'"/>')}if(this.settings.showOnLoad){this.dotShowOnLoad(this)}else{this.dotHideOnLoad(this)}},hideDot:function(){var f=this.settings;var k=this.$dotObj;var m=this.$labelTxtObj;var i=this.$showHideBtnObj;var e;var c;var j;var d;var l=i.outerWidth(true);var h=m.outerWidth(true)+l+"px";var g=(m.outerHeight(true)>i.outerHeight(true))?m.outerHeight(true):i.outerHeight(true);if(f.openDirectionH.toLowerCase()=="rtl"){j=f.leftPos;e=parseInt(k.css("left"),10)+parseInt(h,10)-i.width();if(e!=j){e=j}}else{e=parseInt(k.css("left"),10)}if(f.openDirectionV.toLowerCase()=="up"){d=f.topPos;c=parseInt(k.css("top"),10)+parseInt(g,10)-i.height();if(c!=d){c=d}}else{c=parseInt(k.css("top"),10)}if(f.aniType.toLowerCase()=="slide"){m.animate({opacity:0},f.aniSpeed*1000);k.addClass("animated").animate({left:e,top:c,width:i.width(),height:i.height(),opacity:1},f.aniSpeed*1000,function(){m.css("display","none");k.removeClass("animated").dequeue();k.removeClass("showonload");k.css("zIndex",1)})}else{m.hide();k.css({left:e,top:c,width:i.width(),height:i.height()})}i.removeClass("hideBtn")},showDot:function(){var e=this.settings;var k=this.$dotObj;var m=this.$labelTxtObj;var i=this.$showHideBtnObj;var d;var c;var l=i.outerWidth(true);var g=m.outerWidth(true)+l+"px";var f=(m.outerHeight(true)>i.outerHeight(true))?m.outerHeight(true):i.outerHeight(true);var j=b(k).parent();var h=0;b("div",j).each(function(){var n=parseInt(b(this).css("zIndex"),10);if(n>h){h=n}if(e.showOnlyOne){if(b("p:nth-child(2)",this).attr("class")=="showHideBtn hideBtn"){if(b(this).hasClass("rtl")){tmpLeftPos=parseInt(b(this).css("left"),10);d=tmpLeftPos+parseInt(b(".labelTxt",this).outerWidth(true),10)}if(b(this).hasClass("up")){tmpTopPos=parseInt(b(this).css("top"),10);c=tmpTopPos+parseInt(b(".labelTxt",this).outerHeight(true),10)-i.outerHeight(true)}if(e.aniType=="slide"){b(".labelTxt",this).animate({opacity:0},e.aniSpeed*1000);b(this).animate({left:d,top:c,width:i.width(),height:i.height()},function(){b(".labelTxt",this).hide()})}else{b(this).css({left:d,top:c,width:i.width(),height:i.height()});b(".labelTxt",this).hide()}b("p:nth-child(2)",this).removeClass("hideBtn")}}});k.css("zIndex",h+1);if(e.openDirectionH.toLowerCase()=="rtl"){d=e.leftPos-parseInt(g,10)+i.width();k.addClass("rtl")}else{d=e.leftPos}if(e.openDirectionV.toLowerCase()=="up"){c=e.topPos-parseInt(f,10)+i.width();k.addClass("up")}else{c=e.topPos}if(e.aniType.toLowerCase()=="slide"){if(!k.hasClass("animated")){m.css({display:"inline-block",opacity:0});m.dequeue().stop().animate({opacity:1},e.aniSpeed*1000);k.dequeue().stop().animate({left:d,top:c,width:g,opacity:1,height:f},e.aniSpeed*1000)}}else{m.show();k.css({left:d,top:c,width:g,height:f},e.aniSpeed*1000)}i.addClass("hideBtn")},setWidthHeight:function(){var f=this.settings;var l=this.$dotObj;var n=this.$labelTxtObj;var i=this.$showHideBtnObj;var k=this.maxAllowedWidth;var c=this.maxAllowedHeight;var m=i.outerWidth(true);var h=i.outerHeight(true);var g=n.outerWidth(true)+m+"px";var e=n.outerHeight(true)+h+"px";h=(n.outerHeight(true)>i.outerHeight(true))?n.outerHeight(true):i.outerHeight(true);var j=parseInt(n.css("padding-left"),10)+parseInt(n.css("padding-right"),10)+parseInt(n.css("margin-left"),10)+parseInt(n.css("margin-right"),10)+parseInt(n.css("borderLeftWidth"),10)+parseInt(n.css("borderRightWidth"),10)+i.width();var d=parseInt(n.css("padding-top"),10)+parseInt(n.css("padding-bottom"),10)+parseInt(n.css("margin-top"),10)+parseInt(n.css("margin-bottom"),10)+parseInt(n.css("borderTopWidth"),10)+parseInt(n.css("borderBottomWidth"),10);if(f.width==undefined&&f.height==undefined){if(parseInt(g,10)>k){n.css("white-space","normal");n.css("width",k-j);l.css("width",k)}else{l.css("width",g)}e=n.outerHeight(true)+"px";if(parseInt(e,10)>c){n.css("height",c-d);l.css("height",c)}else{l.css("height",e)}}else{if(f.width>0&&f.height==undefined){if(f.width>k){n.css("white-space","normal");n.css("width",k-j);l.css("width",k)}else{n.css("width",f.width-j);l.css("width",f.width)}e=n.outerHeight(true)+"px";if(f.showOnLoad){if(f.thumbImg!=undefined){b(".labelTxt img").load(function(){e=n.outerHeight(true)+"px";l.css("height",e);if(parseInt(e,10)>c){n.css("height",c-d);l.css("height",c)}else{l.css("height",e)}})}else{if(parseInt(e,10)>c){n.css("height",c-d);l.css("height",c)}else{l.css("height",e)}}}else{if(parseInt(e,10)>c){n.css("height",c-d)}}}else{if(f.width==undefined&&f.height>0){if(parseInt(g,10)>k){n.css("white-space","normal");n.css("width",k-j);l.css("width",k)}else{n.css("white-space","nowrap");if(n.outerWidth(true)+m>parseInt(g,10)){n.css("white-space","normal");n.css("width",k-j);l.css("width",k);n.css("height",f.height)}else{n.css("white-space","nowrap");l.css("width",n.outerWidth(true)+m)}}if(f.height>c){n.css("height",c-d);l.css("height",c)}else{l.css("height",f.height)}}else{if(f.width>k){n.css("white-space","normal");n.css("width",k-j);l.css("width",k)}else{n.css("width",f.width-j);l.css("width",f.width)}if(f.height>c){n.css("height",c-d);l.css("height",c)}else{n.css("white-space","normal");l.css("height",f.height);n.css("height",f.height)}}}}if(f.showOnLoad==false){l.css({width:i.width(),height:i.height()})}else{m=i.outerWidth(true);g=n.outerWidth(true)+m+"px";h=(n.outerHeight(true)>i.outerHeight(true))?n.outerHeight(true):i.outerHeight(true);if(f.openDirectionH.toLowerCase()=="rtl"){l.css("left",parseInt(l.css("left"),10)-parseInt(g,10))}if(f.openDirectionV.toLowerCase()=="up"){l.css("top",parseInt(l.css("top"),10)-parseInt(h,10))}}},dotShowOnLoad:function(f){var e=this.settings;var g=this.$dotObj;var c=this.$labelTxtObj;var d=this.$showHideBtnObj;c.css("display","inline-block");d.addClass("hideBtn");this.setWidthHeight();if(e.eventType.toLowerCase()=="hover"){g.addClass("showonload");g.hover(function(){var h=b(this);if(!h.hasClass("animated")&&!h.hasClass("showonload")){f.showDot()}},function(){f.hideDot()});g.delegate(".hideBtn","click",function(){f.hideDot()})}else{if(e.eventType.toLowerCase()=="click"){d.click(function(){if(d.attr("class")=="showHideBtn"){f.showDot()}else{f.hideDot()}})}}},dotHideOnLoad:function(f){var e=this.settings;var g=this.$dotObj;var c=this.$labelTxtObj;var d=this.$showHideBtnObj;c.css("display","none");this.setWidthHeight();if(e.eventType.toLowerCase()=="hover"){g.hover(function(){if(!b(this).hasClass("animated")){f.showDot()}},function(){f.hideDot()});g.delegate(".hideBtn","click",function(){f.hideDot()})}else{if(e.eventType.toLowerCase()=="click"){d.click(function(){if(d.attr("class")=="showHideBtn"){f.showDot()}else{f.hideDot()}})}}}};b.fn.addDot=function(c){return this.each(function(e,g){var d=b(this);var f=new a(this,c);f.buildHotSpot(c);d.data("addDot",f)})};b.fn.addDot.defaults={leftPos:0,topPos:0,label:"Label Text",showOnLoad:false,showOnlyOne:false,aniSpeed:1,aniType:"none",boundaryPadding:0,withinBoundary:false,eventType:"click",openDirectionH:"ltr",openDirectionV:"down"};b.fn._reverse=[].reverse})(jQuery);